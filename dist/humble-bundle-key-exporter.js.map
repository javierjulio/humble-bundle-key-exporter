{"version":3,"file":"humble-bundle-key-exporter.js","sources":["../src/index.js"],"sourcesContent":["/**\n * Returns a new Promise that is resolved by a timer for the given milliseconds.\n * @param  { Number } ms - milliseconds\n * @returns { Promise } - a promise that is resolved by a timer\n */\nexport function delayOf(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n\n/**\n * Given the blob data and file name, the file is downloaded in the browser.\n * @param  { String } data - the blob data\n * @param  { String } name - the file name\n */\nexport function downloadFile(data, name) {\n  const a = document.createElement('a')\n  a.href = URL.createObjectURL(new Blob([data]))\n  a.download = name\n  a.click()\n  setTimeout(() => URL.revokeObjectURL(a.href), 500)\n}\n\nconst hideRedeemed = async () => {\n  const checkbox = document.getElementById('hide-redeemed')\n  console.log('Hiding redeemed keys.')\n  if (!checkbox.checked) {\n    checkbox.click()\n    await delayOf(250)\n  }\n}\n\nconst setFirstPage = async () => {\n  console.log('Setting first page.')\n  document.querySelector('.js-jump-to-page[data-index=\"0\"]').click()\n  await delayOf(100)\n}\n\nconst getKeysForCurrentPage = () => {\n  // Exclude special rows like Humble Choice \"Make My Choices\" row/button\n  return [...document.querySelectorAll('.unredeemed-keys-table tbody tr[class=\"\"]')].map(row => {\n    return {\n      platform: row.querySelector('.platform :first-child').title.trim(),\n      name: row.querySelector('.game-name h4').textContent.trim().replace(/®|™/g, ''),\n      bundle: row.querySelector('.game-name p').textContent.trim(),\n      bundle_url: row.querySelector('.game-name a').href\n    }\n  })\n}\n\nconst hasNextPage = () => document.querySelector('.js-jump-to-page.current + .js-jump-to-page') !== null\n\nconst setNextPage = async () => {\n  const page = document.querySelector('.js-jump-to-page.current + .js-jump-to-page')\n  if (page !== null) {\n    page.click()\n    await delayOf(100)\n  }\n}\n\nconst getAllKeys = async () => {\n  let data = getKeysForCurrentPage()\n  if (hasNextPage()) {\n    await setNextPage()\n    return data.concat(await getAllKeys())\n  } else {\n    return data\n  }\n}\n\nconst run = () => {\n  if (window.location.pathname.includes('/home/keys')) {\n    setFirstPage()\n      .then(hideRedeemed)\n      .then(getAllKeys)\n      .then(data => JSON.stringify(data, null, 2))\n      .then(json => downloadFile(json, 'humble-bundle-keys.json'))\n  } else {\n    console.log(\"No eligible page detected.\")\n  }\n}\n\nexport { run, hasNextPage, getKeysForCurrentPage }\n"],"names":["delayOf","ms","Promise","resolve","setTimeout","downloadFile","data","name","a","document","createElement","href","URL","createObjectURL","Blob","download","click","revokeObjectURL","hideRedeemed","async","checkbox","getElementById","console","log","checked","getKeysForCurrentPage","querySelectorAll","map","row","platform","querySelector","title","trim","textContent","replace","bundle","bundle_url","hasNextPage","getAllKeys","page","setNextPage","concat","window","location","pathname","includes","setFirstPage","then","JSON","stringify","json"],"mappings":"qDAKO,SAASA,EAAQC,GACtB,OAAO,IAAIC,SAAQC,GAAWC,WAAWD,EAASF,IACpD,CAOO,SAASI,EAAaC,EAAMC,GACjC,MAAMC,EAAIC,SAASC,cAAc,KACjCF,EAAEG,KAAOC,IAAIC,gBAAgB,IAAIC,KAAK,CAACR,KACvCE,EAAEO,SAAWR,EACbC,EAAEQ,QACFZ,YAAW,IAAMQ,IAAIK,gBAAgBT,EAAEG,OAAO,IAChD,CAEA,MAAMO,EAAeC,UACnB,MAAMC,EAAWX,SAASY,eAAe,iBACzCC,QAAQC,IAAI,yBACPH,EAASI,UACZJ,EAASJ,cACHhB,EAAQ,KACf,EASGyB,EAAwB,IAErB,IAAIhB,SAASiB,iBAAiB,8CAA8CC,KAAIC,IAC9E,CACLC,SAAUD,EAAIE,cAAc,0BAA0BC,MAAMC,OAC5DzB,KAAMqB,EAAIE,cAAc,iBAAiBG,YAAYD,OAAOE,QAAQ,OAAQ,IAC5EC,OAAQP,EAAIE,cAAc,gBAAgBG,YAAYD,OACtDI,WAAYR,EAAIE,cAAc,gBAAgBnB,SAK9C0B,EAAc,IAAgF,OAA1E5B,SAASqB,cAAc,+CAU3CQ,EAAanB,UACjB,IAAIb,EAAOmB,IACX,OAAIY,UAVclB,WAClB,MAAMoB,EAAO9B,SAASqB,cAAc,+CACvB,OAATS,IACFA,EAAKvB,cACChB,EAAQ,KACf,EAMOwC,GACClC,EAAKmC,aAAaH,MAElBhC,CACR,sFAGS,KACNoC,OAAOC,SAASC,SAASC,SAAS,cAvCnB1B,WACnBG,QAAQC,IAAI,uBACZd,SAASqB,cAAc,oCAAoCd,cACrDhB,EAAQ,IAAI,EAqChB8C,GACGC,KAAK7B,GACL6B,KAAKT,GACLS,MAAKzC,GAAQ0C,KAAKC,UAAU3C,EAAM,KAAM,KACxCyC,MAAKG,GAAQ7C,EAAa6C,EAAM,6BAEnC5B,QAAQC,IAAI,6BACb"}